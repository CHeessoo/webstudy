<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Document</title>
  <script src="../../assets/js/lib/jquery-3.7.1.min.js"></script>
</head>
<body>

  <script>

    // 비동기 통신은 요청 이후에 응답을 기다리지 않는다!

    var a;  // a는 undefined
    $.ajax({
      type: 'get',
      url: 'product1.xml',
      async: true,
      dataType: 'xml',
      success: function(resData){
        a = $(resData).find('product').length;
      }
    })
    console.log(a);  // a는 3을 기대하지만, ajax 응답이 올 때까지 기다리지 않고 이 코드가 처리된다.

  </script>

  <script>

    /*
      Promise 객체
      1. 비동기 처리의 결과(성공 또는 실패) 값을 나타낼 수 있는 객체이다.
        (비동기 처리를 할 때 응답이 올 때까지 기다리는 JavaScript 객체이다.)
      2. Promise 상태
        1) 대기상태 : pending,   이행도 하지 않고 거부도 하지 않은 초기 상태
        2) 이행상태 : fulfilled, 비동기 처리가 성공적으로 완료된 상태
        3) 거부상태 : reject,    비동기 처리가 실패된 상태
      3. Promise 메소드
        1) Promise.resolve() : 이행상태에서 호출하는 메소드이다. resolve() 메소드가 반환하는 프로미스는 then() 메소드를 따라가서 처리된다. 
        2) Promise.reject()  : 거부상태에서 호출하는 메소드이다. reject() 메소드가 반환하는 프로미스는 catch() 메소드를 따라가서 처리된다.
    */

    // Promise 객체 생성
    var promise = new Promise(function(resolve, reject){

      // 랜덤으로 이행상태(성공)와 거부상태(실패)를 생성
      if(Math.random() < 0.5){
      resolve('이행');  // resolve() 메소드를 호출하면 then() 메소드에서 정의한 함수가 실행된다.
      } else {
        reject('거부');  // reject() 메소드를 호출하면 catch() 메소드에서 정의한 함수가 실행된다.
      }

    });

    // Promise가 이행상태인 경우
    promise.then(function(str){
      console.log(str + '상태');
    });

    // Promise가 거부상태인 경우
    promise.catch(function(str){
      console.log(str + '상태');
    });

  </script>

  <script>

    // Promise 객체 생성 + then() 메소드 호출 + catch() 메소드 호출    (좀 더 보편적이고 일반적인 형식)
    new Promise(function(resolve, reject){
      $.ajax({
        type: 'get',
        url: 'product1.xml',
        async: true,
        dataType: 'xml',
        success: function(resData){
          resolve($(resData).find('product').length);  // resolve(3)
        },
        error: function(jqXHR){
          reject($(jqXHR.status));  // reject(404)
        }
      })
    }).then(function(length){
      console.log(length);
    }).catch(function(status){
      console.log(status);
    })

  </script>


  <hr>


  <div>
    
  </div>
  
</body>
</html>